var https = require("https");
var xml2js = require("xml2js");

var config = {
	host: "www.goodreads.com",
	port: 443,
	key: "n8hATXd6wzepLEZo5zlhkg",
	user: "4175880-retorick"
};

exports.getShelf = function(req, res) {
	var shelf = req.params.shelf;

	grshelf(res, shelf).end();
}

function grshelf(res, shelf) {
	var parser = xml2js.Parser();

	var options = {
		hostname: config.host,
		port: config.port,
		path: "/review/list.xml?id=" + config.user + "&key=" + config.key + "&shelf=" + shelf,
		method: "GET"
	};
	
	var handler = 
		https.request(options, function(httpRes) {
			var body = "";

			httpRes.on("data", function(piece) {
				body += piece;
			});

			httpRes.on("end", function() {
				parser.parseString(body, function(err, data) {
					var books = data.GoodreadsResponse.books[0].book;
					var bookList = [];
					books.forEach(function(obj) {
						bookList.push(obj.title[0]);
					});
					res.json(bookList);
				});
			});

		});

	return handler;
}
